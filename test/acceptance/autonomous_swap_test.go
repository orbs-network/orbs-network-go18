package acceptance

import (
	"context"
	"github.com/ethereum/go-ethereum/accounts/abi/bind"
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/core/types"
	"github.com/orbs-network/orbs-client-sdk-go/orbsclient"
	"github.com/orbs-network/orbs-network-go/crypto/keys"
	"github.com/orbs-network/orbs-network-go/services/crosschainconnector/ethereum/adapter"
	"github.com/orbs-network/orbs-network-go/services/processor/native/repository/ASBEthereum"
	"github.com/orbs-network/orbs-network-go/services/processor/native/repository/ERC20Proxy"
	"github.com/orbs-network/orbs-network-go/test"
	"github.com/orbs-network/orbs-network-go/test/builders"
	testKeys "github.com/orbs-network/orbs-network-go/test/crypto/keys"
	"github.com/orbs-network/orbs-network-go/test/harness"
	"github.com/orbs-network/orbs-spec/types/go/primitives"
	"github.com/orbs-network/orbs-spec/types/go/protocol"
	"github.com/stretchr/testify/require"
	"math/big"
	"testing"
)

func TestTransferFromEthereumToOrbs(t *testing.T) {
	t.Skip()
	harness.Network(t).
		Start(func(ctx context.Context, network harness.TestNetworkDriver) {
			d := newAutonomousSwapDriver(network)

			etherAmountBefore := big.NewInt(20)
			amountToTransfer := big.NewInt(17)

			d.generateOrbsAccount(t)

			d.deployTokenContractToEthereum(t)
			d.generateEthereumAccountAndAssignFunds(t, etherAmountBefore)

			d.deployAutonomousSwapBridgeToEthereum(t)
			d.bindOrbsAutonomousSwapBridgeToEthereum(ctx, t)

			d.approveTransferInEthereumTokenContract(t, amountToTransfer)
			transferOutTxHash := d.transferOutFromEthereum(t, amountToTransfer)
			t.Log("Eth tx hash", transferOutTxHash)

			// TODO v1 deploy causes who is owner - important for both.
			d.transferInToOrbs(ctx, t, transferOutTxHash)

			balanceAfterTransfer := d.getBalanceInOrbs(ctx, t)
			require.EqualValues(t, amountToTransfer.Uint64(), balanceAfterTransfer, "wrong amount of tokens in orbs")

			etherBalanceAfterTransfer := d.getBalanceInEthereum(t)
			require.EqualValues(t, etherAmountBefore.Sub(etherAmountBefore, amountToTransfer).Uint64(), etherBalanceAfterTransfer, "wrong amount of tokens left in ethereum")

		})
}

func TestTransferFromOrbsToEthereum(t *testing.T) {
	t.Skip()
	harness.Network(t).
		Start(func(ctx context.Context, network harness.TestNetworkDriver) {
			d := newAutonomousSwapDriver(network)

			etherAmount := big.NewInt(3)
			amount := big.NewInt(17)

			d.generateOrbsAccount(t)
			d.generateOrbsFunds(ctx, t, amount)

			d.deployTokenContractToEthereum(t)
			d.generateEthereumAccountAndAssignFunds(t, etherAmount)

			d.deployAutonomousSwapBridgeToEthereum(t)
			d.bindOrbsAutonomousSwapBridgeToEthereum(ctx, t)

			// TODO v1 deploy causes who is owner - important for both.
			d.transferOutFromOrbs(ctx, t, amount)

			//d.transferInToEthereum(ctx, t)

			//balanceAfterTransfer := d.getBalanceInEthereum(t)
			//require.EqualValues(t, etherAmount.Add(etherAmount, amount).Uint64(), balanceAfterTransfer, "wrong amount")

			orbsBalanceAfterTransfer := d.getBalanceInOrbs(ctx, t)
			require.EqualValues(t, 0, orbsBalanceAfterTransfer, "wrong amount")
		})
}

func newAutonomousSwapDriver(networkDriver harness.TestNetworkDriver) *driver {
	simulator := networkDriver.EthereumSimulator()
	return &driver{
		network:                  networkDriver,
		simulator:                simulator,
		addressInEthereum:        simulator.GetAuth(),
		orbsASBContractName:      asb_ether.CONTRACT_NAME,
		orbsContractOwnerAddress: testKeys.Ed25519KeyPairForTests(5),
	}
}

type driver struct {
	network   harness.TestNetworkDriver
	simulator *adapter.EthereumSimulator

	orbsContractOwnerAddress *keys.Ed25519KeyPair
	orbsASBContractName      string
	orbsUser                 *orbsclient.OrbsAccount
	orbsUserAddress          [20]byte
	orbsUserKeyPair          *keys.Ed25519KeyPair

	addressInEthereum *bind.TransactOpts // we use a single address for both the "admin" stuff like deploying the contracts and as our swapping user, so as to simplify setup - otherwise we'll need to create two PKs in the simulator

	erc20contract  *bind.BoundContract
	erc20address   *common.Address
	ethASBAddress  *common.Address
	ethASBContract *bind.BoundContract
}

// orbs side funcs
func (d *driver) generateOrbsAccount(t *testing.T) {
	orbsUser, err := orbsclient.CreateAccount()
	require.NoError(t, err, "could not create orbs address")

	copy(d.orbsUserAddress[:], orbsUser.RawAddress)
	d.orbsUser = orbsUser
	d.orbsUserKeyPair = keys.NewEd25519KeyPair(orbsUser.PublicKey, orbsUser.PrivateKey)
}

func (d *driver) generateOrbsFunds(ctx context.Context, t *testing.T, amount *big.Int) {
	response, txHash := d.network.SendTransaction(ctx, builders.Transaction().
		WithMethod(primitives.ContractName(erc20proxy.CONTRACT_NAME), "mint").
		WithEd25519Signer(d.orbsContractOwnerAddress).
		WithArgs(d.orbsUser.RawAddress, amount.Uint64()).
		Builder(), 0)
	d.network.WaitForTransactionInState(ctx, txHash)
	test.RequireSuccess(t, response, "failed setting minting tokens at orbs")
}

func (d *driver) getBalanceInOrbs(ctx context.Context, t *testing.T) uint64 {
	balanceResponse := d.network.CallMethod(ctx, builders.Transaction().
		WithEd25519Signer(d.orbsContractOwnerAddress).
		WithMethod(primitives.ContractName(erc20proxy.CONTRACT_NAME), "balanceOf").
		WithArgs(d.orbsUser.RawAddress).
		Builder().Transaction, 0)
	require.EqualValues(t, protocol.EXECUTION_RESULT_SUCCESS, balanceResponse.CallMethodResult())
	// check that the tokens got there.
	outputArgsIterator := builders.ClientCallMethodResponseOutputArgumentsDecode(balanceResponse)
	value := outputArgsIterator.NextArguments().Uint64Value()
	return value
}

func (d *driver) approveTransferInOrbsTokenContract(ctx context.Context, t *testing.T, amount *big.Int) {
	response, txHash := d.network.SendTransaction(ctx, builders.Transaction().
		WithEd25519Signer(d.orbsUserKeyPair).
		WithMethod(primitives.ContractName(erc20proxy.CONTRACT_NAME), "approve").
		WithArgs(d.addressInEthereum.From, amount.Uint64()).
		Builder(), 0)
	d.network.WaitForTransactionInState(ctx, txHash)
	test.RequireSuccess(t, response, "failed approve transfer in orbs")
}

func (d *driver) bindOrbsAutonomousSwapBridgeToEthereum(ctx context.Context, t *testing.T) {
	response, txHash := d.network.SendTransaction(ctx, builders.Transaction().
		WithMethod(primitives.ContractName(d.orbsASBContractName), "setAsbAddr").
		WithEd25519Signer(d.orbsContractOwnerAddress).
		WithArgs(d.ethASBAddress.Hex()).
		Builder(), 0)
	d.network.WaitForTransactionInState(ctx, txHash)
	test.RequireSuccess(t, response, "failed setting asb address")
}

func (d *driver) transferInToOrbs(ctx context.Context, t *testing.T, transferOutTxHash string) {
	response, txHash := d.network.SendTransaction(ctx, builders.Transaction().
		WithMethod(primitives.ContractName(d.orbsASBContractName), "transferIn").
		WithEd25519Signer(d.orbsContractOwnerAddress).
		WithArgs(transferOutTxHash).
		Builder(), 0)
	d.network.WaitForTransactionInState(ctx, txHash)
	test.RequireSuccess(t, response, "failed transferIn in orbs")
}

func (d *driver) transferOutFromOrbs(ctx context.Context, t *testing.T, amount *big.Int) {
	response, txHash := d.network.SendTransaction(ctx, builders.Transaction().
		WithMethod(primitives.ContractName(d.orbsASBContractName), "transferOut").
		WithEd25519Signer(d.orbsUserKeyPair).
		WithArgs(d.addressInEthereum.From.Bytes(), amount.Uint64()).
		Builder(), 0)
	d.network.WaitForTransactionInState(ctx, txHash)

	t.Log(response.StringTransactionReceipt())
	t.Log(builders.PackedArgumentArrayDecode(response.TransactionReceipt().RawOutputArgumentArrayWithHeader()))
	test.RequireSuccess(t, response, "failed transfer out in orbs")
}

// Ethereum related funcs
func (d *driver) deployAutonomousSwapBridgeToEthereum(t *testing.T) {
	fakeFederation := common.BigToAddress(big.NewInt(1700))
	zero := common.BigToAddress(big.NewInt(0))

	ethAsbAddress, ethAsbContract, err := d.simulator.DeployEthereumContract(d.addressInEthereum, asbABI, asbByteCode, uint32(0), uint64(builders.DEFAULT_TEST_VIRTUAL_CHAIN_ID), //TODO CHANGE IN LEoNId,
		d.orbsASBContractName, d.erc20address, fakeFederation, zero)
	require.NoError(t, err, "could not deploy asb to Ethereum")
	d.simulator.Commit()
	d.ethASBAddress = ethAsbAddress
	d.ethASBContract = ethAsbContract
}

func (d *driver) deployTokenContractToEthereum(t *testing.T) {
	ethTetAddress, ethTetContract, err := d.simulator.DeployEthereumContract(d.addressInEthereum, tetABI, tetByteCode)
	require.NoError(t, err, "could not deploy erc token to Ethereum")
	d.simulator.Commit()
	d.erc20contract = ethTetContract
	d.erc20address = ethTetAddress
}

func (d *driver) generateEthereumAccountAndAssignFunds(t *testing.T, amount *big.Int) {
	ethContractUserAuth := d.addressInEthereum
	// we don't REALLY care who is the user we transfer from, so for simplicity's sake we use the same mega-user defined when simulator is created
	_, err := d.erc20contract.Transact(d.addressInEthereum, "assign", ethContractUserAuth.From /*address of user*/, amount)
	// generate token in source address
	require.NoError(t, err, "could not assign token to sender")
	d.simulator.Commit()
}

func (d *driver) getBalanceInEthereum(t *testing.T) uint64 {
	ethContractUserAuth := d.addressInEthereum
	// we don't REALLY care who is the user we transfer from, so for simplicity's sake we use the same mega-user defined when simulator is created
	var (
		ret0 = new(*big.Int)
	)
	result := ret0
	err := d.erc20contract.Call(nil, result, "balanceOf", ethContractUserAuth.From /*address of user*/)
	// generate token in source address
	require.NoError(t, err, "could not get token balance of user")
	d.simulator.Commit()
	return (*result).Uint64()
}

func (d *driver) approveTransferInEthereumTokenContract(t *testing.T, amount *big.Int) {
	tx, err := d.erc20contract.Transact(d.addressInEthereum, "approve", d.ethASBAddress, amount)
	require.NoError(t, err, "could not approve transfer")
	d.simulator.Commit()
	receipt, err := d.simulator.Receipt(tx.Hash())
	require.NoError(t, err, "could not get receipt")
	require.EqualValues(t, types.ReceiptStatusSuccessful, receipt.Status, "call to approve on tet in Ethereum failed")

}

func (d *driver) transferOutFromEthereum(t *testing.T, amount *big.Int) string {
	transferOutTx, err := d.ethASBContract.Transact(d.addressInEthereum, "transferOut", d.orbsUserAddress, amount)
	d.simulator.Commit()
	require.NoError(t, err, "could not transfer out")

	receipt, err := d.simulator.Receipt(transferOutTx.Hash())
	require.NoError(t, err, "could not get receipt")
	require.EqualValues(t, types.ReceiptStatusSuccessful, receipt.Status, "call to transferOut on ASB in Ethereum failed")

	return transferOutTx.Hash().Hex()
}

const tetABI = `[{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"from","type":"address"},{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"owner","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"constant":false,"inputs":[{"name":"_account","type":"address"},{"name":"_value","type":"uint256"}],"name":"assign","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"}]`
const tetByteCode = "0x608060405234801561001057600080fd5b506111aa806100206000396000f300608060405260043610610099576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063095ea7b31461009e57806318160ddd1461010357806323b872dd1461012e57806339509351146101b357806370a0823114610218578063a457c2d71461026f578063a9059cbb146102d4578063be76048814610339578063dd62ed3e14610386575b600080fd5b3480156100aa57600080fd5b506100e9600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001909291905050506103fd565b604051808215151515815260200191505060405180910390f35b34801561010f57600080fd5b5061011861052a565b6040518082815260200191505060405180910390f35b34801561013a57600080fd5b50610199600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610534565b604051808215151515815260200191505060405180910390f35b3480156101bf57600080fd5b506101fe600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001909291905050506106e6565b604051808215151515815260200191505060405180910390f35b34801561022457600080fd5b50610259600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919050505061091d565b6040518082815260200191505060405180910390f35b34801561027b57600080fd5b506102ba600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610965565b604051808215151515815260200191505060405180910390f35b3480156102e057600080fd5b5061031f600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610b9c565b604051808215151515815260200191505060405180910390f35b34801561034557600080fd5b50610384600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919080359060200190929190505050610bb3565b005b34801561039257600080fd5b506103e7600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610bd3565b6040518082815260200191505060405180910390f35b60008073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415151561043a57600080fd5b81600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925846040518082815260200191505060405180910390a36001905092915050565b6000600254905090565b6000600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205482111515156105c157600080fd5b61065082600160008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610c5a90919063ffffffff16565b600160008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506106db848484610c7b565b600190509392505050565b60008073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415151561072357600080fd5b6107b282600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610e9490919063ffffffff16565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546040518082815260200191505060405180910390a36001905092915050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b60008073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16141515156109a257600080fd5b610a3182600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610c5a90919063ffffffff16565b600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546040518082815260200191505060405180910390a36001905092915050565b6000610ba9338484610c7b565b6001905092915050565b610bc582610bc08461091d565b610eb5565b610bcf8282611040565b5050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b600080838311151515610c6c57600080fd5b82840390508091505092915050565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548111151515610cc857600080fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1614151515610d0457600080fd5b610d55816000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610c5a90919063ffffffff16565b6000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550610de8816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610e9490919063ffffffff16565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040518082815260200191505060405180910390a3505050565b6000808284019050838110151515610eab57600080fd5b8091505092915050565b60008273ffffffffffffffffffffffffffffffffffffffff1614151515610edb57600080fd5b6000808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548111151515610f2857600080fd5b610f3d81600254610c5a90919063ffffffff16565b600281905550610f94816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610c5a90919063ffffffff16565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040518082815260200191505060405180910390a35050565b60008273ffffffffffffffffffffffffffffffffffffffff161415151561106657600080fd5b61107b81600254610e9490919063ffffffff16565b6002819055506110d2816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610e9490919063ffffffff16565b6000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040518082815260200191505060405180910390a350505600a165627a7a7230582094609698b7c76dff80d05dcaa6cb6f31fb8f800a5026ee62cf6e4f71bba041a40029"

const asbABI = `[{"constant":true,"inputs":[],"name":"EXECUTION_RESULT_SUCCESS","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"MAX_SIGNATURES","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"BLOCKREFMESSAGE_SIZE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"ORBS_ADDRESS_SIZE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"SIGNATURE_SIZE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"BLOCKHASH_OFFSET","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"SHA256_SIZE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"EXECUTION_RESULT_OFFSET","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"orbsASBContractName","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"federation","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"UINT32_SIZE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"ORBS_PROTOCOL_VERSION","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"renounceOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"NODE_PK_SIG_NESTING_SIZE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"isOwner","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"spentOrbsTuids","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"UINT64_SIZE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"TRANSFERRED_OUT","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"virtualChainId","outputs":[{"name":"","type":"uint64"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"ADDRESS_SIZE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"tuidCounter","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"UINT256_SIZE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"ONEOF_NESTING_SIZE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"networkType","outputs":[{"name":"","type":"uint32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"token","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"VERSION","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_networkType","type":"uint32"},{"name":"_virtualChainId","type":"uint64"},{"name":"_orbsASBContractName","type":"string"},{"name":"_token","type":"address"},{"name":"_federation","type":"address"},{"name":"_verifier","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"tuid","type":"uint256"},{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"bytes20"},{"indexed":false,"name":"value","type":"uint256"}],"name":"TransferredOut","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"tuid","type":"uint256"},{"indexed":true,"name":"from","type":"bytes20"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"TransferredIn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"previousOwner","type":"address"},{"indexed":true,"name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"constant":false,"inputs":[{"name":"_to","type":"bytes20"},{"name":"_value","type":"uint256"}],"name":"transferOut","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_resultsBlockHeader","type":"bytes"},{"name":"_resultsBlockProof","type":"bytes"},{"name":"_transactionReceipt","type":"bytes"},{"name":"_transactionReceiptProof","type":"bytes32[]"}],"name":"transferIn","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"}]`
const asbByteCode = "0x608060405260006004553480156200001657600080fd5b50604051620039ac380380620039ac833981018060405281019080805190602001909291908051906020019092919080518201929190602001805190602001909291908051906020019092919080519060200190929190505050336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a360008451111515620001cc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260298152602001807f4f7262732041534220636f6e7472616374206e616d65206d757374206e6f742081526020017f626520656d70747921000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415151562000272576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260148152602001807f546f6b656e206d757374206e6f7420626520302100000000000000000000000081525060200191505060405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415151562000318576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260198152602001807f46656465726174696f6e206d757374206e6f742062652030210000000000000081525060200191505060405180910390fd5b85600060146101000a81548163ffffffff021916908363ffffffff16021790555084600060186101000a81548167ffffffffffffffff021916908367ffffffffffffffff16021790555083600190805190602001906200037a92919062000409565b5082600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555081600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505050505050620004b8565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200044c57805160ff19168380011785556200047d565b828001600101855582156200047d579182015b828111156200047c5782518255916020019190600101906200045f565b5b5090506200048c919062000490565b5090565b620004b591905b80821115620004b157600081600090555060010162000497565b5090565b90565b6134e480620004c86000396000f30060806040526004361061017f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806212117d14610184578063037a3796146101af578063047ee7e8146101da57806326413cd014610205578063308ff0c91461023057806333d7fafd1461025b578063397d6e17146102a1578063550bed71146102cc5780635680b8aa146102f75780635c45428c1461032257806366c86119146103b2578063690ba608146104095780636d2c93ac14610434578063715018a61461045f5780638d9ecc66146104765780638da5cb5b146104a15780638f32d59b146104f8578063923aebf0146105275780639c3db9a51461056c578063b11954b314610597578063bd19dffb146105c2578063c4c3c17e14610601578063d2b43fee1461062c578063e1d5c25514610764578063eea7f0ab1461078f578063f18a25ce146107ba578063f2fde38b146107e5578063f3762c1114610828578063fc0c546a1461085f578063ffa1ad74146108b6575b600080fd5b34801561019057600080fd5b506101996108e1565b6040518082815260200191505060405180910390f35b3480156101bb57600080fd5b506101c46108e6565b6040518082815260200191505060405180910390f35b3480156101e657600080fd5b506101ef6108eb565b6040518082815260200191505060405180910390f35b34801561021157600080fd5b5061021a6108f0565b6040518082815260200191505060405180910390f35b34801561023c57600080fd5b506102456108f5565b6040518082815260200191505060405180910390f35b34801561026757600080fd5b5061029f60048036038101908080356bffffffffffffffffffffffff19169060200190929190803590602001909291905050506108fa565b005b3480156102ad57600080fd5b506102b6610c18565b6040518082815260200191505060405180910390f35b3480156102d857600080fd5b506102e1610c1d565b6040518082815260200191505060405180910390f35b34801561030357600080fd5b5061030c610c22565b6040518082815260200191505060405180910390f35b34801561032e57600080fd5b50610337610c27565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561037757808201518184015260208101905061035c565b50505050905090810190601f1680156103a45780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156103be57600080fd5b506103c7610cc5565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561041557600080fd5b5061041e610ceb565b6040518082815260200191505060405180910390f35b34801561044057600080fd5b50610449610cf0565b6040518082815260200191505060405180910390f35b34801561046b57600080fd5b50610474610cf5565b005b34801561048257600080fd5b5061048b610dc7565b6040518082815260200191505060405180910390f35b3480156104ad57600080fd5b506104b6610dcc565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561050457600080fd5b5061050d610df5565b604051808215151515815260200191505060405180910390f35b34801561053357600080fd5b5061055260048036038101908080359060200190929190505050610e4c565b604051808215151515815260200191505060405180910390f35b34801561057857600080fd5b50610581610e6c565b6040518082815260200191505060405180910390f35b3480156105a357600080fd5b506105ac610e71565b6040518082815260200191505060405180910390f35b3480156105ce57600080fd5b506105d7610e76565b604051808267ffffffffffffffff1667ffffffffffffffff16815260200191505060405180910390f35b34801561060d57600080fd5b50610616610e90565b6040518082815260200191505060405180910390f35b34801561063857600080fd5b50610762600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290505050610e95565b005b34801561077057600080fd5b50610779611515565b6040518082815260200191505060405180910390f35b34801561079b57600080fd5b506107a461151b565b6040518082815260200191505060405180910390f35b3480156107c657600080fd5b506107cf611520565b6040518082815260200191505060405180910390f35b3480156107f157600080fd5b50610826600480360381019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050611525565b005b34801561083457600080fd5b5061083d611544565b604051808263ffffffff1663ffffffff16815260200191505060405180910390f35b34801561086b57600080fd5b5061087461155a565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b3480156108c257600080fd5b506108cb611580565b6040518082815260200191505060405180910390f35b600181565b606481565b603481565b601481565b604181565b61090382611585565b1515610977576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260188152602001807f4f726273206164647265737320697320696e76616c696421000000000000000081525060200191505060405180910390fd5b6000811115156109ef576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601d8152602001807f56616c7565206d7573742062652067726561746572207468616e20302100000081525060200191505060405180910390fd5b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166323b872dd3330846040518463ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019350505050602060405180830381600087803b158015610ae857600080fd5b505af1158015610afc573d6000803e3d6000fd5b505050506040513d6020811015610b1257600080fd5b81019080805190602001909291905050501515610b97576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260178152602001807f496e73756666696369656e7420616c6c6f77616e63652100000000000000000081525060200191505060405180910390fd5b610bad60016004546115cf90919063ffffffff16565b600481905550816bffffffffffffffffffffffff19163373ffffffffffffffffffffffffffffffffffffffff166004547fc7d2da8a0df0279cb4e0a81f2975445675cc6527c94016791d29977a1fa0f251846040518082815260200191505060405180910390a45050565b601481565b602081565b602481565b60018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610cbd5780601f10610c9257610100808354040283529160200191610cbd565b820191906000526020600020905b815481529060010190602001808311610ca057829003601f168201915b505050505081565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600481565b600281565b610cfd610df5565b1515610d0857600080fd5b600073ffffffffffffffffffffffffffffffffffffffff166000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a360008060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550565b600481565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614905090565b60056020528060005260406000206000915054906101000a900460ff1681565b600881565b600181565b600060189054906101000a900467ffffffffffffffff1681565b601481565b610e9d6132bc565b610ea9858585856115f0565b9050600073ffffffffffffffffffffffffffffffffffffffff16816080015173ffffffffffffffffffffffffffffffffffffffff1614151515610f54576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601f8152602001807f44657374696e6174696f6e20616464726573732063616e27742062652030210081525060200191505060405180910390fd5b60008160a00151111515610fd0576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601d8152602001807f56616c7565206d7573742062652067726561746572207468616e20302100000081525060200191505060405180910390fd5b806000015163ffffffff16600060149054906101000a900463ffffffff1663ffffffff16141515611069576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260178152602001807f496e636f7272656374206e6574776f726b20747970652100000000000000000081525060200191505060405180910390fd5b806020015167ffffffffffffffff16600060189054906101000a900467ffffffffffffffff1667ffffffffffffffff1614151561110e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807f496e636f7272656374207669727475616c20636861696e20494421000000000081525060200191505060405180910390fd5b6111bf816040015160018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156111ac5780601f10611181576101008083540402835291602001916111ac565b820191906000526020600020905b81548152906001019060200180831161118f57829003601f168201915b5050505050611aaf90919063ffffffff16565b1515611259576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260218152602001807f496e636f7272656374204f7262732041534220636f6e7472616374206e616d6581526020017f210000000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b600560008260c00151815260200190815260200160002060009054906101000a900460ff161515156112f3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260178152602001807f545549442077617320616c7265616479207370656e742100000000000000000081525060200191505060405180910390fd5b6001600560008360c00151815260200190815260200160002060006101000a81548160ff021916908315150217905550600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663a9059cbb82608001518360a001516040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b1580156113f057600080fd5b505af1158015611404573d6000803e3d6000fd5b505050506040513d602081101561141a57600080fd5b8101908080519060200190929190505050151561149f576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260138152602001807f496e73756666696369656e742066756e6473210000000000000000000000000081525060200191505060405180910390fd5b806080015173ffffffffffffffffffffffffffffffffffffffff1681606001516bffffffffffffffffffffffff19168260c001517f0e1884a0d68b0d4801a22895bf83fe72c3ae24c9cf5b2dec620e192dd225b8a88460a001516040518082815260200191505060405180910390a45050505050565b60045481565b602081565b600c81565b61152d610df5565b151561153857600080fd5b61154181611b9d565b50565b600060149054906101000a900463ffffffff1681565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600181565b6000806c01000000000000000000000000026bffffffffffffffffffffffff1916826bffffffffffffffffffffffff191614156115c557600090506115ca565b600190505b919050565b60008082840190508381101515156115e657600080fd5b8091505092915050565b6115f86132bc565b61160061332f565b611608613382565b6116106133a2565b61161988611c97565b92506002836000015163ffffffff1614151561169d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601d8152602001807f556e737570706f727465642070726f746f636f6c2076657273696f6e2100000081525060200191505060405180910390fd5b6116a78888611e0c565b73__CryptoUtils___________________________636df6588e868560800151896040518463ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018080602001846000191660001916815260200180602001838103835286818151815260200191508051906020019060200280838360005b8381101561174857808201518184015260208101905061172d565b50505050905001838103825284818151815260200191508051906020019080838360005b8381101561178757808201518184015260208101905061176c565b50505050905090810190601f1680156117b45780820380516001836020036101000a031916815260200191505b509550505050505060206040518083038186803b1580156117d457600080fd5b505af41580156117e8573d6000803e3d6000fd5b505050506040513d60208110156117fe57600080fd5b810190808051906020019092919050505015156118a9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001807f496e76616c6964207472616e73616374696f6e20726563656970742070726f6f81526020017f662100000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b6118b2866120ac565b91506001826000015163ffffffff16141515611936576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260198152602001807f496e76616c696420657865637574696f6e20726573756c74210000000000000081525060200191505060405180910390fd5b6119438260200151612181565b90506001816020015163ffffffff161415156119c7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260118152602001807f496e76616c6964206576656e742049442100000000000000000000000000000081525060200191505060405180910390fd5b8260400151846000019063ffffffff16908163ffffffff16815250508260200151846020019067ffffffffffffffff16908167ffffffffffffffff168152505080600001518460400181905250806060015184606001906bffffffffffffffffffffffff191690816bffffffffffffffffffffffff1916815250508060800151846080019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508060a001518460a0018181525050806040015167ffffffffffffffff168460c0018181525050505050949350505050565b600081518351141515611ac55760009050611b97565b816040518082805190602001908083835b602083101515611afb5780518252602082019150602081019050602083039250611ad6565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051809103902060001916836040518082805190602001908083835b602083101515611b625780518252602082019150602081019050602083039250611b3d565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040518091039020600019161490505b92915050565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614151515611bd957600080fd5b8073ffffffffffffffffffffffffffffffffffffffff166000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a3806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b611c9f61332f565b6000809050611cb7818461256f90919063ffffffff16565b826000019063ffffffff16908163ffffffff1681525050611ce26004826115cf90919063ffffffff16565b9050611cf7818461258590919063ffffffff16565b826020019067ffffffffffffffff16908167ffffffffffffffff1681525050611d2a6008826115cf90919063ffffffff16565b9050611d3f818461256f90919063ffffffff16565b826040019063ffffffff16908163ffffffff1681525050611d6a6004826115cf90919063ffffffff16565b9050611d7f818461258590919063ffffffff16565b826060019067ffffffffffffffff16908167ffffffffffffffff1681525050611db26008826115cf90919063ffffffff16565b9050611dc86028826115cf90919063ffffffff16565b9050611ddd818461259b90919063ffffffff16565b82608001906000191690816000191681525050611e046020826115cf90919063ffffffff16565b905050919050565b611e1461340e565b600080611e20846125c4565b92506002856040518082805190602001908083835b602083101515611e5a5780518252602082019150602081019050602083039250611e35565b6001836020036101000a0380198251168184511680821785525050505050509050019150506020604051808303816000865af1158015611e9e573d6000803e3d6000fd5b5050506040513d6020811015611eb357600080fd5b8101908080519060200190929190505050915060028360200151836040516020018083600019166000191681526020018260001916600019168152602001925050506040516020818303038152906040526040518082805190602001908083835b602083101515611f395780518252602082019150602081019050602083039250611f14565b6001836020036101000a0380198251168184511680821785525050505050509050019150506020604051808303816000865af1158015611f7d573d6000803e3d6000fd5b5050506040513d6020811015611f9257600080fd5b810190808051906020019092919050505090508260600151600019168160001916141515612028576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260198152602001807f426c6f636b206861736820646f65736e2774206d61746368210000000000000081525060200191505060405180910390fd5b61203183612a9f565b15156120a5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260128152602001807f496e76616c6964207369676e617475726521000000000000000000000000000081525060200191505060405180910390fd5b5050505050565b6120b4613382565b600080600091506120cf6024836115cf90919063ffffffff16565b91506120e4828561256f90919063ffffffff16565b836000019063ffffffff16908163ffffffff168152505061210f6004836115cf90919063ffffffff16565b9150612124828561256f90919063ffffffff16565b905061213a6004836115cf90919063ffffffff16565b9150612157828263ffffffff1686612f899092919063ffffffff16565b83602001819052506121788163ffffffff16836115cf90919063ffffffff16565b91505050919050565b6121896133a2565b60008060008060008094506121a860008861256f90919063ffffffff16565b93506121be6004866115cf90919063ffffffff16565b94506121db858563ffffffff1689612f899092919063ffffffff16565b86600001819052506121fc8463ffffffff16866115cf90919063ffffffff16565b9450612211858861256f90919063ffffffff16565b866020019063ffffffff16908163ffffffff168152505061223c6004866115cf90919063ffffffff16565b9450612251858861258590919063ffffffff16565b866040019067ffffffffffffffff16908167ffffffffffffffff16815250506122846008866115cf90919063ffffffff16565b9450612299858861256f90919063ffffffff16565b925060148363ffffffff16141515612319576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601a8152602001807f496e76616c6964204f72627320616464726573732073697a652100000000000081525060200191505060405180910390fd5b61232d6004866115cf90919063ffffffff16565b9450612342858861301690919063ffffffff16565b86606001906bffffffffffffffffffffffff191690816bffffffffffffffffffffffff19168152505061237f6014866115cf90919063ffffffff16565b9450612394858861256f90919063ffffffff16565b915060148263ffffffff16141515612414576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601e8152602001807f496e76616c696420457468657265756d20616464726573732073697a6521000081525060200191505060405180910390fd5b6124286004866115cf90919063ffffffff16565b945061243d85886130a890919063ffffffff16565b866080019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250506124886014866115cf90919063ffffffff16565b945061249d858861256f90919063ffffffff16565b905060208163ffffffff1614151561251d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260138152602001807f496e76616c69642076616c75652073697a65210000000000000000000000000081525060200191505060405180910390fd5b6125316004866115cf90919063ffffffff16565b945061254685886130e090919063ffffffff16565b8660a00181815250506125636020866115cf90919063ffffffff16565b94505050505050919050565b600061257d838360046130f6565b905092915050565b6000612593838360086130f6565b905092915050565b600080602083018451101515156125b157600080fd5b8260208501015190508091505092915050565b6125cc61340e565b600080600080600093506125e9848761256f90919063ffffffff16565b856000019063ffffffff16908163ffffffff16815250506126146004856115cf90919063ffffffff16565b9350612629848761256f90919063ffffffff16565b925060208363ffffffff161415156126a9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260128152602001807f496e76616c696420686173682073697a6521000000000000000000000000000081525060200191505060405180910390fd5b6126bd6004856115cf90919063ffffffff16565b93506126d2848761259b90919063ffffffff16565b856020019060001916908160001916815250506126f96020856115cf90919063ffffffff16565b935061270f600c856115cf90919063ffffffff16565b9350600261272985603489612f899092919063ffffffff16565b6040518082805190602001908083835b60208310151561275e5780518252602082019150602081019050602083039250612739565b6001836020036101000a0380198251168184511680821785525050505050509050019150506020604051808303816000865af11580156127a2573d6000803e3d6000fd5b5050506040513d60208110156127b757600080fd5b8101908080519060200190929190505050856040019060001916908160001916815250506127ef6014856115cf90919063ffffffff16565b9350612804848761259b90919063ffffffff16565b8560600190600019169081600019168152505061282b6020856115cf90919063ffffffff16565b93505b8551841015612a965761284b6004856115cf90919063ffffffff16565b9350612860848761256f90919063ffffffff16565b915060148263ffffffff161415156128e0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260158152602001807f496e76616c696420616464726573732073697a6521000000000000000000000081525060200191505060405180910390fd5b6128f46004856115cf90919063ffffffff16565b935061290984876130a890919063ffffffff16565b8560a00151866080015160ff1660648110151561292257fe5b602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505061296d6014856115cf90919063ffffffff16565b9350612982848761256f90919063ffffffff16565b905060418163ffffffff16141515612a02576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260178152602001807f496e76616c6964207369676e61747572652073697a652100000000000000000081525060200191505060405180910390fd5b612a166004856115cf90919063ffffffff16565b9350612a2e84604188612f899092919063ffffffff16565b8560c00151866080015160ff16606481101515612a4757fe5b6020020181905250612a636041856115cf90919063ffffffff16565b9350612a806001866080015160ff166115cf90919063ffffffff16565b856080019060ff16908160ff168152505061282e565b50505050919050565b600080600060606000806060600080600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663925f50728b600001516040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808263ffffffff168152602001915050602060405180830381600087803b158015612b4957600080fd5b505af1158015612b5d573d6000803e3d6000fd5b505050506040513d6020811015612b7357600080fd5b8101908080519060200190929190505050975060009650896080015160ff16604051908082528060200260200182016040528015612bc05781602001602082028038833980820191505090505b509550600094505b896080015160ff16851015612f77578960a0015185606481101515612be957fe5b602002015193508960c0015185606481101515612c0257fe5b60200201519250600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663ddef11608b60000151866040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808363ffffffff1681526020018273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200192505050602060405180830381600087803b158015612cd857600080fd5b505af1158015612cec573d6000803e3d6000fd5b505050506040513d6020811015612d0257600080fd5b81019080805190602001909291905050501515612d1e57612f6c565b73__CryptoUtils___________________________6365a18acf8b6040015185876040518463ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808460001916600019168152602001806020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828103825284818151815260200191508051906020019080838360005b83811015612dea578082015181840152602081019050612dcf565b50505050905090810190601f168015612e175780820380516001836020036101000a031916815260200191505b5094505050505060206040518083038186803b158015612e3657600080fd5b505af4158015612e4a573d6000803e3d6000fd5b505050506040513d6020811015612e6057600080fd5b81019080805190602001909291905050501515612e7c57612f6c565b60019150600090505b84811015612eec578581815181101515612e9b57fe5b9060200190602002015173ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff161415612ee15760009150612eec565b806001019050612e85565b811515612ef857612f6c565b838686815181101515612f0757fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050612f576001886115cf90919063ffffffff16565b96508787101515612f6b5760019850612f7c565b5b846001019450612bc8565b600098505b5050505050505050919050565b606080828401855110151515612f9e57600080fd5b821560008114612fb95760405191506020820160405261300a565b6040519150601f8416801560200281840101858101878315602002848b0101015b81831015612ff75780518352602083019250602081019050612fda565b50868552601f19601f8301166040525050505b50809150509392505050565b60008060148301845110151515613095576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600f8152602001807f496e76616c6964206c656e67746821000000000000000000000000000000000081525060200191505060405180910390fd5b8260208501015190508091505092915050565b600080601483018451101515156130be57600080fd5b6c01000000000000000000000000836020860101510490508091505092915050565b60006130ee838360206130f6565b905092915050565b60006060613117613112858588612f899092919063ffffffff16565b61312f565b90506131258160008561322b565b9150509392505050565b606080600083516040519080825280601f01601f1916602001820160405280156131685781602001602082028038833980820191505090505b509150600090505b835181101561322157838181518110151561318757fe5b9060200101517f010000000000000000000000000000000000000000000000000000000000000090047f01000000000000000000000000000000000000000000000000000000000000000282600183875103038151811015156131e657fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350806001019050613170565b8192505050919050565b6000808284018551101515156132a9576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600f8152602001807f496e76616c6964206c656e67746821000000000000000000000000000000000081525060200191505060405180910390fd5b8383860101519050809150509392505050565b60e060405190810160405280600063ffffffff168152602001600067ffffffffffffffff1681526020016060815260200160006bffffffffffffffffffffffff19168152602001600073ffffffffffffffffffffffffffffffffffffffff16815260200160008152602001600081525090565b60a060405190810160405280600063ffffffff168152602001600067ffffffffffffffff168152602001600063ffffffff168152602001600067ffffffffffffffff168152602001600080191681525090565b6040805190810160405280600063ffffffff168152602001606081525090565b60c06040519081016040528060608152602001600063ffffffff168152602001600067ffffffffffffffff16815260200160006bffffffffffffffffffffffff19168152602001600073ffffffffffffffffffffffffffffffffffffffff168152602001600081525090565b6119a060405190810160405280600063ffffffff168152602001600080191681526020016000801916815260200160008019168152602001600060ff16815260200161345861346b565b815260200161346561348f565b81525090565b610c8060405190810160405280606490602082028038833980820191505090505090565b610c80604051908101604052806064905b60608152602001906001900390816134a057905050905600a165627a7a72305820c694a073a9ef077afb607348a978fede8a47303a511416998570f86685380dc00029"
